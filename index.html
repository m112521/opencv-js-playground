<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <title>Opencv.js Playground</title>
        <meta name="description" content="OpenCV.js example">
        <meta name="author" content="Azamt Tavitov">
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="styles/style.css">
        <link rel="icon" type="image/png" href="assets/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="assets/favicon-16x16.png" sizes="16x16" />
        
        <script async src="scripts/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
        <script defer src="scripts/script.js" type="text/javascript"></script>
    </head>
    <body>
        <div class="container"> 
            <div class="header">
                <div class="title">
                    Opencv.js Playground
                </div>
                <div>
                    <button id="generateJS"  class="btn_generate">Generate code</button>
                </div>
            </div> 
            <div class="left-col">
                <div class="out_canvas">
                    <img id="imageOriginal" alt="Upload" class="card-img-top" style="max-width:49vw"/>
                </div>
                <div class="fullwidth_btn">
                    <input type="file" id="imageInput" name="file" />
                </div>
            </div> 
            <div class="right-col">
                <div class="out_canvas">
                    <canvas id="imageCanvas"></canvas>
                </div>
                <div class="inline_btns">
                    <button id="roi" class="canvas_btn">ROI</button>
                    <button id="button" class="canvas_btn">Download Image</button>
                    <button id="reload" class="canvas_btn">Reload Image</button>
                    <button id="revert" class="canvas_btn">Cancel last</button>
                </div>
            </div> 
            <div class="controls">
                <div class="card-grid">
                    <!-- inRange -->
                    <div class="card">

                        <!-- In range color  -->
                        <div class="card_content">
                            <p class="op-title">Thresholding in range
                                <a target="blank" href="https://docs.opencv.org/3.4/db/d64/tutorial_js_colorspaces.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>

                            <label for="color_start" data-tooltip="RGB start of the range">Start range</label>
                            <input type="color" id="color_start" name="head" value="#000000">
                            <br />
                            <label for="body" data-tooltip="RGB end of the range">End range</label>
                            <input type="color" id="color_end" name="body" value="#ff0000">
                        </div>
                        <button type="button" id="in_range" class="btn_apply">Apply</button>
                    </div>

                    <!-- CVT Change -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">Change colorspace 
                                <a target="blank" href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga4e0972be5de079fed4e3a10e24ef5ef0"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>
                            <label for="cvt_type" data-tooltip="Choose colorspace">Type</label>
                            <select id="cvt_type" name="alg">
                                <option value="cv.COLOR_RGBA2GRAY">RGBA2GRAY</option>
                                <!-- <option value="cv.COLOR_GRAY2BGR">cv.COLOR_GRAY2RGBA</option> -->
                            </select>
                        </div>
                        <button id="cvt_color" class="btn_apply">Apply</button>
                    </div>
                    
                    
                    <!-- Threshold -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">Basic thresholding 
                                <a target="blank" href="https://docs.opencv.org/3.4/d7/dd0/tutorial_js_thresholding.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>

                            <label for="thresh1" data-tooltip="Threshold value">Threshold</label> 
                            <input type="range" id="thresh1" value="1" min="0" max="255" step="1" onchange="thresh1_txt.value=value" />
                            <output id="thresh1_txt">1</output><br />
                            
                            <label for="thresh2" data-tooltip="Max value to use with the cv.THRESH_BINARY and cv.THRESH_BINARY_INV thresholding types">Max value</label>
                            <input type="range" id="thresh2" value="1" min="0" max="255" step="1" onchange="thresh2_txt.value=value" />
                            <output id="thresh2_txt">1</output><br />

                            <label for="thresh_type" data-tooltip="Thresholding type">Type</label>
                            <select id="thresh_type" name="alg">
                            <option value="cv.THRESH_BINARY">cv.THRESH_BINARY</option>
                            <option value="cv.THRESH_BINARY_INV">cv.THRESH_BINARY_INV</option>
                            <option value="cv.THRESH_TRUNC">cv.THRESH_TRUNC</option>
                            <option value="cv.THRESH_TOZERO">cv.THRESH_TOZERO</option>
                            </select>    
                        </div>
                        <button type="button" id="thresh_btn" class="btn_apply">Apply</button>
                    </div>

                    <!-- Smoothing / filters -->
                    <div class="card">
                        <div class="card_content var_card">
                            <p class="op-title">Filters 
                                <a target="blank" href="https://docs.opencv.org/master/dd/d6a/tutorial_js_filtering.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>
                            <label for="filter_type" data-tooltip="Choose filter">Type</label>
                            <select id="filter_type" name="alg">
                                <option value="blur">Blur</option>
                                <option value="gaussian">Gaussian Blur</option>
                                <option value="median">Median Blur</option>
                                <option value="custom">Custom filter</option>
                            </select>
                            <br>
                            <div id="div_filter">
                                <label for="custom_filter" data-tooltip="Comma separated filter matrix">Filter</label>
                                <textarea id="custom_filter" rows="3" cols="5">0,-1,0&#13;&#10;0,-1,0&#13;&#10;0,-1,0</textarea>    
                            </div>
                            <br />
                            <label for="filter_kernel" data-tooltip="Matrix size">Kernel</label>
                            <input type="range" id="filter_kernel" value="3" min="0" max="10" step="1" onchange="filter_kernel_txt.value=value" />
                            <output id="filter_kernel_txt">3</output>
                        </div>
                        <button type="button" id="filter" class="btn_apply">Apply</button>
                    </div>

                    <!-- Gradients -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title" data-tooltip="Must be applied after colorspace change RGBA2GRAY">Gradients 
                                <a target="blank" href="https://docs.opencv.org/3.4/da/d85/tutorial_js_gradients.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>

                            <label for="gmode" data-tooltip="OpenCV provides three types of gradient filters or High-pass filters, Sobel, Scharr and Laplacian">Filter</label>
                            <select id="gmode" name="gmode">
                            <option value="dstx">Sobel X</option>
                            <option value="dsty">Sobel Y</option>
                            <option value="laplacian">Laplacian</option>
                            </select>
                        </div>
                        <button type="button" id="laplacian_btn" class="btn_apply">Apply</button>
                    </div>
                    
                    <!-- Canny Edge detection -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">Canny edge detection 
                                <a target="blank" href="https://docs.opencv.org/3.4/d7/de1/tutorial_js_canny.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>

                            <label for="canny1" class="slider_label" data-tooltip="First threshold for the hysteresis procedure">Threshold 1</label> 
                            <input type="range" id="canny1" value="50" min="0" max="200" step="1" onchange="canny1_txt.value=value" />
                            <output id="canny1_txt">50</output><br />
                            
                            <label for="canny2" class="slider_label" data-tooltip="Second threshold for the hysteresis procedure">Threshold 2</label>
                            <input type="range" id="canny2" value="50" min="0" max="200" step="1" onchange="canny2_txt.value=value" />
                            <output id="canny2_txt">50</output><br />
                            
                            <label for="canny3" class="slider_label" data-tooltip="Aperture size for the Sobel operator">Aperture size</label>
                            <input type="range" id="canny3" value="3" min="3" max="7" step="1" onchange="canny3_txt.value=value" />
                            <output id="canny3_txt">3</output><br />    
                        </div>
                        <button type="button" id="canny" class="btn_apply">Apply</button>    
                    </div>

                    <!-- Morphological operations -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">Morphological 
                                <a target="blank" href="https://docs.opencv.org/3.4/d4/d76/tutorial_js_morphological_ops.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>
                            <label for="alg" data-tooltip="Choose operation">Type</label>
                            <select id="alg" name="alg">
                                <option value="erosion">Erosion</option>
                                <option value="dilation">Dilation</option>
                                <option value="opening">Opening</option>
                                <option value="closing">Closing</option>
                            </select>
                            <br />
                            <label for="morph_kernel" data-tooltip="Structuring element used for erosion">Kernel Size</label>
                            <input type="range" id="morph_kernel" value="3" min="0" max="10" step="1" onchange="kernel_txt.value=value" />
                            <output id="kernel_txt">3</output>
                            <br />
                            <label for="morph_iters" data-tooltip="Number of times erosion is applied">Iterations</label>
                            <input type="range" id="morph_iters" value="1" min="0" max="10" step="1" onchange="iters_txt.value=value" />
                            <output id="iters_txt">1</output><br />    
                        </div>
                        <button type="button" id="morph" class="btn_apply">Apply</button>
                    </div>

                    <!-- Contours -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">Contours 
                                <a target="blank" href="https://docs.opencv.org/3.4/d0/d43/tutorial_js_table_of_contents_contours.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>
                            <label for="mode" data-tooltip="Mode of the contours detection">Mode</label>
                            <select id="mode" name="mode">
                            <option value="cv.RETR_EXTERNAL">cv.RETR_EXTERNAL</option>
                            <option value="cv.RETR_LIST">cv.RETR_LIST</option>
                            <option value="cv.RETR_CCOMP">cv.RETR_CCOMP</option>
                            <option value="cv.RETR_TREE">cv.RETR_TREE</option>
                            </select>    
                        </div>
                        <button type="button" id="contours" class="btn_apply">Apply</button>
                    </div>
                    
                    <!-- Contour area, perimeter, center of mass -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">Contour data 
                                <a target="blank" href="https://docs.opencv.org/3.4/d0/d43/tutorial_js_table_of_contents_contours.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>
                            <label for="cnts_count" data-tooltip="Number of contours found">N of contours</label>
                            <output id="cnts_count"></output>
                            <br />
                            <label for="bbox" data-tooltip="Interested contour number">Contour #</label>
                            <input type="number" id="bbox" value="0" min="0" />    
                            <br />
                            <label for="cnt_area" data-tooltip="Interested contour area">Cnt area</label>
                            <output id="cnt_area"></output>
                            <br />
                            <label for="cnt_centroid" data-tooltip="Interested contour centroid">Centroid</label>
                            <output id="cnt_centroid"></output>
                        </div>
                        <button type="button" id="bbox_btn" class="btn_apply_spec">Apply</button>  
                    </div>  
                    
                    <!-- Hough Lines  -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title" data-tooltip="Must be applied after colorspace change RGBA2GRAY">Hough lines
                                <a target="blank" href="https://docs.opencv.org/master/d3/de6/tutorial_js_houghlines.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>

                            <label for="hough1_line" data-tooltip="Distance resolution of the accumulator in pixels">rho</label>
                            <input type="range" id="hough1_line" value="1" min="0" max="30" step="1" onchange="hough1_txt_line.value=value" />
                            <output id="hough1_txt_line">1</output><br />

                            <label for="hough2_line" data-tooltip="Angle resolution of the accumulator in degrees">theta</label>
                            <input type="range" id="hough2_line" value="1" min="0" max="180" step="1" onchange="hough2_txt_line.value=value" />
                            <output id="hough2_txt_line">1</output><br />

                            <label for="hough3_line" data-tooltip="Accumulator threshold parameter. Only those lines are returned that get enough votes">Threshold</label>
                            <input type="range" id="hough3_line" value="30" min="0" max="200" step="1" onchange="hough3_txt_line.value=value"/>
                            <output id="hough3_txt_line">30</output><br />
                            
                            <label for="hough4_line" data-tooltip="A divisor for the distance resolution rho. The coarse accumulator distance resolution is rho and the accurate accumulator resolution is rho/srn . If both srn=0 and stn=0 , the classical Hough transform is used. Otherwise, both these parameters should be positive">srn</label>
                            <input type="range" id="hough4_line" value="0" min="0" max="100" step="1" onchange="hough4_txt_line.value=value"/>
                            <output id="hough4_txt_line">0</output><br />

                            <label for="hough5_line" data-tooltip="For the multi-scale Hough transform, it is a divisor for the distance resolution theta">stn</label>
                            <input type="range" id="hough5_line" value="0" min="0" max="100" step="1" onchange="hough5_txt_line.value=value"/>
                            <output id="hough5_txt_line">0</output><br />

                            <label for="hough6_line" data-tooltip="Minimum angle to check for lines. Must fall between 0 and max_theta">Min theta</label>
                            <input type="range" id="hough6_line" value="0" min="0" max="180" step="1" onchange="hough6_txt_line.value=value"/>
                            <output id="hough6_txt_line">0</output><br />

                            <label for="hough7_line" data-tooltip="Maximum angle to check for lines. Must fall between min_theta and CV_PI">Max theta</label>
                            <input type="range" id="hough7_line" value="180" min="0" max="180" step="1" onchange="hough7_txt_line.value=value"/>
                            <output id="hough7_txt_line">180</output><br />
                        </div>
                        <button type="button" id="hough_line" class="btn_apply">Apply</button>
                    </div>

                    <!-- Hough Circles -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title" data-tooltip="Must be applied after colorspace change RGBA2GRAY">Hough circles
                                <a target="blank" href="https://docs.opencv.org/3.4/d3/de5/tutorial_js_houghcircles.html"><i class="fa fa-code" aria-hidden="true"></i></a> 
                            </p>

                            <label for="hough1" data-tooltip="Inverse ratio of the accumulator resolution to the image resolution. For example, if dp = 1 , the accumulator has the same resolution as the input image. If dp = 2 , the accumulator has half as big width and height">dp</label>
                            <input type="range" id="hough1" value="1" min="0" max="10" step="1" onchange="hough1_txt.value=value" />
                            <output id="hough1_txt">1</output><br />

                            <label for="hough2" data-tooltip="Minimum distance between the centers of the detected circles. If the parameter is too small, multiple neighbor circles may be falsely detected in addition to a true one. If it is too large, some circles may be missed">Dist</label>
                            <input type="range" id="hough2" value="45" min="0" max="200" step="1" onchange="hough2_txt.value=value" />
                            <output id="hough2_txt">45</output><br />

                            <label for="hough3" data-tooltip="The higher threshold of the two passed to the Canny edge detector (the lower one is twice smaller)">Param 1</label>
                            <input type="range" id="hough3" value="75" min="0" max="200" step="1" onchange="hough3_txt.value=value"/>
                            <output id="hough3_txt">75</output><br />
                            
                            <label for="hough4" data-tooltip="The accumulator threshold for the circle centers at the detection stage. The smaller it is, the more false circles may be detected. Circles, corresponding to the larger accumulator values, will be returned first.">Param 2</label>
                            <input type="range" id="hough4" value="40" min="0" max="200" step="1" onchange="hough4_txt.value=value"/>
                            <output id="hough4_txt">40</output><br />

                            <label for="hough5" data-tooltip="Min circle radius">Min R</label>
                            <input type="range" id="hough5" value="0" min="0" max="500" step="1" onchange="hough5_txt.value=value"/>
                            <output id="hough5_txt">0</output><br />

                            <label for="hough6" data-tooltip="Max circle radius">Max R</label>
                            <input type="range" id="hough6" value="0" min="0" max="500" step="1" onchange="hough6_txt.value=value"/>
                            <output id="hough6_txt">0</output><br />

                        </div>
                        <button type="button" id="hough" class="btn_apply">Apply</button>
                    </div>

                    <!-- ROI contours -->
                    <div class="card">
                        <div class="card_content">
                            <p class="op-title">ROI Contours [DEMO]
                                <!-- <a target="blank" href=""><i class="fa fa-code" aria-hidden="true"></i></a>  -->
                            </p>
                        </div>
                        <button id="changeRoi" class="btn_apply">Apply</button>
                    </div>                    

                </div>
            </div>
        </div>
    <div class="modal"></div>
    <div id="code">
        <div class="popup">
            <p id="js_code"></p>
            <button id="close">Close</button>
        </div>
    </div>
    </body>
</html>